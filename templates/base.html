<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <!-- Meta viewport para habilitar el responsive real en móviles (iPhone Safari requiere esto) -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <title>{% block title %}MyPlanner{% endblock %}</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
      <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap"
    rel="stylesheet" />
    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>

    <!-- Bootstrap y CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FullCalendar CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/bootstrap5@6.1.15/index.global.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">


</head>

<body class="bg-light text-light">


    <!-- Responsive Sidebar & Hamburger -->
    <div class="d-flex" style="min-height:100vh;">
        <!-- Hamburger button (visible on mobile) -->
        <button id="sidebarToggle" class="btn btn-dark d-md-none position-fixed" style="top:16px;left:16px;z-index:1100;">
            <span class="fa fa-bars"></span>
        </button>

        <!-- Sidebar -->
        <aside role="complementary" aria-label="Sidebar" id="sidebar" class="bg-dark text-light flex-shrink-0 p-3 sidebar-responsive"
            style="width:16rem;transition:left 0.3s;left:0;z-index:1090;">
            <div class="d-flex flex-column" style="gap:.75rem;">
                <!-- Usuario  -->
                <div class="d-flex align-items-center gap-3 mb-2">
                    <div class="rounded-circle"
                        style="width:48px; height:48px; background-size:cover; background-position:center; background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuC8w4gQAUyg__Pz5qUJG_E3XTetshO4_YIKFMqQKyOOBlh6o2nVxUlpwcK8JyDMCcUF8NneXp_NFdOXFCTSluwSVi96yPDxjCr4_bA9NhMlxZ6IECv90ys-HxLlB4GqnZAtAG6HUOagtP9ZaHHUOSQokZLtU3FRXAdnI79j-54cE77VNZT2B_vlkf9VOlCVX2nAxdiIjDDpe2LlA52k_A3GnIB5zIhg6KPjO6tcx0bMZclABUUuDnlL5g-EF9gjDyOI9VX7wzjF-pk');">
                    </div>
                    <h1 class="h6 mb-0"><strong>{{ session['usuario'] }}</strong></h1>
                </div>
                <!-- Navbar Links -->
                <nav aria-label="Main navigation">
                    <ul class="nav nav-pills flex-column">
                        <li class="nav-item mb-1">
                            <a href="{{ url_for('dashboard') }}" class="nav-link text-light sidebar-link">
                                <span class="material-symbols-outlined me-2" style="font-size: 18px; vertical-align: middle;">dashboard</span>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item mb-1">
                            <a href="{{ url_for('calendar') }}" class="nav-link text-light sidebar-link">
                                <span class="material-symbols-outlined me-2" style="font-size: 18px; vertical-align: middle;">calendar_month</span>
                                <span>Calendario</span>
                            </a>
                        </li>
                        <li class="nav-item mb-1">
                            <a href="{{ url_for('ver_eventos') }}" class="nav-link text-light sidebar-link">
                                <span class="material-symbols-outlined me-2" style="font-size: 18px; vertical-align: middle;">event</span>
                                <span>Eventos</span>
                            </a>
                        </li>
                        <li class="nav-item mb-1">
                            <a href="{{ url_for('ver_tareas') }}" class="nav-link text-light sidebar-link">
                                <span class="material-symbols-outlined me-2" style="font-size: 18px; vertical-align: middle;">task</span>
                                <span>Tareas</span>
                            </a>
                        </li>
                        <!-- Iniciar/Cerrar sesión -->
                        <li class="nav-item mt-3">
                            {% if session.get('usuario') %}
                            <a href="{{ url_for('logout') }}" class="btn btn-outline-light w-100 mb-2">
                                <span class="material-symbols-outlined me-1" style="font-size: 18px; vertical-align: middle;">logout</span>
                                Cerrar sesión
                            </a>
                            {% else %}
                            <a href="{{ url_for('login') }}" class="btn btn-outline-light w-100 mb-2">
                                <span class="material-symbols-outlined me-1" style="font-size: 18px; vertical-align: middle;">login</span>
                                Iniciar sesión
                            </a>
                            <a href="{{ url_for('register') }}" class="btn w-100" style="background: linear-gradient(to right, rgb(168, 85, 247), rgb(219, 39, 119)); color: white; border: none;">
                                <span class="material-symbols-outlined me-1" style="font-size: 18px; vertical-align: middle;">person_add</span>
                                Registrarse
                            </a>
                            {% endif %}
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Main Contenido -->
        <!-- Añadido padding superior e inferior para separar el contenido del borde superior
             sin afectar al sidebar. Usamos clases responsive para un término medio en móvil y
             más aire en pantallas grandes. -->
        <main class="flex-grow-1 bg-background-light pt-6 pb-5 px-3 px-md-4 pt-md-8" style="min-height:100vh;">
            {% block content %}{% endblock %}
            <!-- Footer fijo global -->
            <footer class="site-footer d-flex justify-content-between align-items-center small text-muted border-top py-2 px-4">
                <div>MyPlanner • Versión 1.4</div>
                <div>Todos los derechos reservados © 2025 Pedro de las Heras</div>
                <div>
                    <a href="{{ url_for('ayuda') }}" class="text-muted me-3">Ayuda</a>
                    <a href="{{ url_for('contacto') }}" class="text-muted">Contacto</a>
                </div>
            </footer>
        </main>
    </div>

    <script>
    // Sidebar responsive toggle
    document.addEventListener('DOMContentLoaded', function() {
        var sidebar = document.getElementById('sidebar');
        var toggleBtn = document.getElementById('sidebarToggle');
        function closeSidebar() {
            sidebar.style.left = '-18rem';
        }
        function openSidebar() {
            sidebar.style.left = '0';
        }
        // Inicialmente oculto en móvil
        function checkWidth() {
            if (window.innerWidth < 768) {
                closeSidebar();
                toggleBtn.style.display = '';
            } else {
                openSidebar();
                toggleBtn.style.display = 'none';
            }
        }
        checkWidth();
        window.addEventListener('resize', checkWidth);
        toggleBtn.addEventListener('click', function() {
            if (sidebar.style.left === '0px' || sidebar.style.left === '0') {
                closeSidebar();
            } else {
                openSidebar();
            }
        });
        // Cerrar sidebar al hacer click fuera en móvil
        document.addEventListener('click', function(e) {
            if (window.innerWidth < 768 && sidebar.style.left === '0px') {
                if (!sidebar.contains(e.target) && e.target !== toggleBtn) {
                    closeSidebar();
                }
            }
        });
        // Asegurar misma fuente y peso activo en enlaces
        document.querySelectorAll('.sidebar-link').forEach(function(link){
            link.style.fontWeight = '500';
        });
    });
    </script>


    <!-- FullCalendar JS -->
    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
        {# Mensajes flash -> se muestran como toast y fallback alert oculto #}
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div style="position:absolute;left:-9999px;top:-9999px;">
                {% for category, msg in messages %}
                    <div class="flash-msg" data-category="{{ category }}">{{ msg }}</div>
                {% endfor %}
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function(){
                    document.querySelectorAll('.flash-msg').forEach(function(el){
                        var cat = el.getAttribute('data-category') || 'success';
                        var text = el.textContent.trim();
                        try { showToast(text, cat === 'error' ? 'error' : 'success'); } catch(e) {}
                    });
                });
            </script>
        {% endif %}
        {% endwith %}
</body>

</html>